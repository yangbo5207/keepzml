1:"$Sreact.fragment"
2:I[51790,["7525","static/chunks/7525-411280bffc37a107.js","8173","static/chunks/8173-1aab990e083a60ce.js","5926","static/chunks/5926-2f921190ce1e6581.js","3974","static/chunks/3974-a1a1a9aca3315bf5.js","7177","static/chunks/app/layout-42df43a67d50e5c7.js"],"default"]
3:I[73974,["7525","static/chunks/7525-411280bffc37a107.js","8173","static/chunks/8173-1aab990e083a60ce.js","5926","static/chunks/5926-2f921190ce1e6581.js","3974","static/chunks/3974-a1a1a9aca3315bf5.js","7177","static/chunks/app/layout-42df43a67d50e5c7.js"],"default"]
4:I[15244,[],""]
5:I[43866,[],""]
6:I[14547,[],"ClientSegmentRoot"]
7:I[83323,["7525","static/chunks/7525-411280bffc37a107.js","8173","static/chunks/8173-1aab990e083a60ce.js","5926","static/chunks/5926-2f921190ce1e6581.js","3974","static/chunks/3974-a1a1a9aca3315bf5.js","5145","static/chunks/app/reactprinciple/layout-25ee351abafcefca.js"],"default"]
9:I[98087,["8150","static/chunks/7cfd557f-0718c923d48595ad.js","7525","static/chunks/7525-411280bffc37a107.js","4320","static/chunks/4320-eb0b4108191194bc.js","8173","static/chunks/8173-1aab990e083a60ce.js","3152","static/chunks/3152-e813ba8dd61cd947.js","8993","static/chunks/8993-f9edac71676d1891.js","3707","static/chunks/app/reactprinciple/(0.eventloop)/6.promise/layout-4434331d5e4556ba.js"],"default"]
b:I[87869,["7525","static/chunks/7525-411280bffc37a107.js","4320","static/chunks/4320-eb0b4108191194bc.js","5926","static/chunks/5926-2f921190ce1e6581.js","2794","static/chunks/2794-e7741df2722cee1f.js","8424","static/chunks/app/reactprinciple/(0.eventloop)/6.promise/page-6ea2b695323b3491.js"],"default"]
14:I[86213,[],"OutletBoundary"]
16:I[86213,[],"MetadataBoundary"]
18:I[86213,[],"ViewportBoundary"]
1a:I[34835,[],""]
:HL["/_next/static/media/569ce4b8f30dc480-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/media/93f479601ee12b01-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/d498c84e4ab246b3.css","style"]
:HL["/_next/static/css/3b8b4919706de55d.css","style"]
:HL["/_next/static/css/738174a5e4c964fb.css","style"]
:HL["/_next/static/css/1823fcda9d6f3fc8.css","style"]
:HL["/_next/static/css/0b88b513390d781e.css","style"]
0:{"P":null,"b":"glaXvcFkq8mtY18xpXvgA","p":"","c":["","reactprinciple","6.promise"],"i":false,"f":[[["",{"children":["reactprinciple",{"children":["(0.eventloop)",{"children":["6.promise",{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d498c84e4ab246b3.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/3b8b4919706de55d.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","2",{"rel":"stylesheet","href":"/_next/static/css/738174a5e4c964fb.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","3",{"rel":"stylesheet","href":"/_next/static/css/1823fcda9d6f3fc8.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"zh","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","meta",null,{"charSet":"UTF-8"}],["$","link",null,{"href":"https://framerusercontent.com/images/YRd2KCq4G2aXNg15aHvl7AtcGQ.png","rel":"icon","media":"(prefers-color-scheme: light)"}],["$","link",null,{"rel":"stylesheet","href":"https://rsms.me/inter/inter.css"}],["$","link",null,{"rel":"stylesheet","href":"https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css","integrity":"sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV","crossOrigin":"anonymous"}],["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1.0 maximum-scale=1, user-scalable=no"}],["$","meta",null,{"name":"mobile-web-app-capable","content":"yes"}],["$","meta",null,{"name":"apple-mobile-web-app-status-bar-style","content":"black-translucent"}]]}],["$","body",null,{"className":"__variable_4d318d __variable_ea5f4b antialiased","children":["$","$L2",null,{"children":[["$","$L3",null,{}],["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]]}]}]]}]]}],{"children":["reactprinciple",["$","$1","c",{"children":[null,["$","$L6",null,{"Component":"$7","slots":{"children":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","reactprinciple","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]},"params":{},"promise":"$@8"}]]}],{"children":["(0.eventloop)",["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","reactprinciple","children","(0.eventloop)","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["6.promise",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/0b88b513390d781e.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L9",null,{"children":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","reactprinciple","children","(0.eventloop)","children","6.promise","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[[["$","h3",null,{"id":"1-promise","children":[["$","strong",null,{"children":"1、"}]," Promise"]}],"\n",["$","p",null,{"children":"解释 Promise 是一件很麻烦的事情。因为我们很难明确的说 Promise 到底是什么。大多数情况下我们都是在稀里糊涂的用他来解决一些异步的逻辑，也不会去深究它到底应该怎么去定义。"}],"\n",["$","p",null,{"children":"最蛋疼的是，讲 Promise 的原理、或者手写 Promise 对象的实现，还成为了一个高频面试题。"}],"\n",["$","p",null,{"children":["首先，Promise 肯定是一个对象。我们可以通过 ",["$","strong",null,{"children":["$","code",null,{"children":"new Promise()"}]}]," 来创建一个 Promise 的实例。Promise 的实现和使用，都应该严格遵循 ",["$","code",null,{"children":"Promise/A+"}]," 规范。所以 Promise 的实现方式就可以不用那么固定。"]}],"\n",["$","p",null,{"children":["也由于遵循了 ",["$","code",null,{"children":"Promise/A+"}]," ，我们也可以称 Promise 是一个简化版的有限状态机制。每一个 Promise 实例中都会维护一个状态，对应三个值"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"pending"}],"：表示正在等待请求结果"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"fulfilled"}],"：通常是有了理想的结果，表示同意"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"rejected"}],"：通常是有了不理想的结果，表示拒绝"]}],"\n"]}],"\n",["$","p",null,{"children":["状态只能从 ",["$","code",null,{"children":"pending"}]," 切换到两个结果态，而不能反过来。有了结果就表示请求结束，任务完成。因此，我们通常将 Promise 用于一个请求只包含两种结果的场景。例如"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"http 请求  -> 请求成功、请求失败"}],"\n",["$","li",null,{"children":"弹窗按钮 -> 确认、取消"}],"\n"]}],"\n",["$","h3",null,{"id":"2-promise-运行机制","children":[["$","strong",null,{"children":"2、"}]," Promise 运行机制"]}],"\n",["$","p",null,{"children":"在 ECMASCript 中，提供了一个用于存储 Promise 任务的执行队列 PromiseJobs。并针对两个不同的结果提供了两个临时队列"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","code",null,{"children":"[[PromiseFulfillReactions]]"}]}],"\n",["$","li",null,{"children":["$","code",null,{"children":"[[PromiseRejectReactions]]"}]}],"\n"]}],"\n",["$","p",null,{"children":["当我们在代码中执行 ",["$","code",null,{"children":".then"}]," 方法时，就会创建一个 ",["$","code",null,{"children":"job"}],"，并优先考虑进入到临时队列中。当 jobs 的状态，有了结果 ",["$","code",null,{"children":"resolve() / reject()"}]," 之后，则会推送到执行队列中，等待执行。"]}],"\n",["$","p",null,{"children":"执行队列 PromiseJobs，滞后于函数调用栈执行，具体的执行顺序为"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"1、函数调用栈"}],"\n",["$","li",null,{"children":"2、promiseJobs 队列"}],"\n",["$","li",null,{"children":["3、",["$","code",null,{"children":"requestAnimationFrame"}]," ",["$","code",null,{"children":"setTimeout"}]," 等其他异步任务队列"]}],"\n"]}],"\n",["$","p",null,{"children":"之所以是这个顺序是由于 PromiseJobs 队列是 JavaScript 自己维护的，因此它作为一个内部队列会被优先执行。"}],"\n",["$","p",null,{"children":"promiseJobs 队列的清空逻辑与之前的执行队列。他的逻辑用该代码演示如下所示。"}],"\n","$La","\n",["$","p",null,{"children":["但是这里有一个很不一样的地方，就是任务进入执行队列的时机。如果我们在执行 ",["$","code",null,{"children":"job"}]," 的过程中，产生了新的 ",["$","code",null,{"children":"job"}],"，或者在临时队列中，有 ",["$","code",null,{"children":"job"}]," 的",["$","strong",null,{"children":"状态有了结果"}],"，该任务依然会推入到正在循环的执行队列中去执行，直到 ",["$","code",null,{"children":"PromiseJobs"}]," 被清空为止。"]}],"\n",["$","p",null,{"children":["用代码来演示这个过程，先看完整案例。这里我按照 ",["$","code",null,{"children":"Promise/A+"}]," 规范，手写实现了一个自定义的 ",["$","code",null,{"children":"XPromise"}]," ，大家可以仔细看一下代码"]}],"\n",["$","$Lb",null,{}],"\n","$Lc","\n",["$","h3",null,{"id":"3-代码解读","children":[["$","strong",null,{"children":"3、"}]," 代码解读"]}],"\n",["$","p",null,{"children":"首先，我们知道 Promise 的状态有两种情况，一种是有结果，一种是等待结果，因此，我们应该将等待中的任务，放入临时队列，将有结果的任务，放入执行队列，所以这个时候，我们需要在内部维护三个队列，其中两个临时队列，一个执行队列"}],"\n","$Ld","\n",["$","p",null,{"children":"需要注意的是，这几个队列并不属于某一个特定的 Promise 对象，它们是管理所有的 Promise 任务。因此我们在模块的全局中维护他们。"}],"\n",["$","p",null,{"children":"进入到临时队列，表示该任务还不能被执行，还需要等待条件满足之后才能执行。进入到执行队列，则表示任务已经满足了执行条件，只需要在符合规定的时机执行即可。"}],"\n",["$","p",null,{"children":["由于执行队列需要滞后于函数调用栈执行，因此，我们这里选择使用 ",["$","code",null,{"children":"setTimeout"}]," 来模拟滞后执行的时机。我们把执行队列的执行称为 ",["$","code",null,{"children":"workLoop"}]]}],"\n",["$","p",null,{"children":["但是这里需要考虑的是，执行队列循环什么时候开始呢？理论上来说，应该是第一个 ",["$","code",null,{"children":"resolve"}]," 执行时，而第二个 ",["$","code",null,{"children":"resolve"}]," 时，则不需要重复启动 ",["$","code",null,{"children":"workLoop"}],"，因此，我们需要管理一个全局的上下文变量 ",["$","code",null,{"children":"loopRunning"}]," ，来记录 ",["$","code",null,{"children":"workLoop"}]," 是否正在执行过程中"]}],"\n","$Le","\n",["$","p",null,{"children":"每个 Promise 都有两个内部值，一个表示状态，一个表示 Promise 的值"}],"\n","$Lf","\n",["$","p",null,{"children":["构造函数传入的第一个参数中，支持 ",["$","code",null,{"children":"resolve"}]," 与 ",["$","code",null,{"children":"reject"}]," 作为参数。我们需要在内部单独处理他们。规则是：当 ",["$","code",null,{"children":"resolve/reject"}]," 执行时，Promise 状态切换为结果态，并且将任务从对应的临时队列移除，并推送到执行队列，结合我们前面的逻辑，代码如下"]}],"\n","$L10","\n",["$","p",null,{"children":[["$","code",null,{"children":"workLoop"}]," 的逻辑比较简单，我们只需利用 setTimeout 来滞后队列的循环，然后按照先进先出的逻辑清空队列即可。队列清空循环结束之后，需要将 ",["$","code",null,{"children":"loopRunning"}]," 重置为 ",["$","code",null,{"children":"false"}]]}],"\n","$L11","\n",["$","p",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":".then(() => {})"}]}],"  将任务推送到临时队列的逻辑稍微复杂一点。由于这里需要支持返回一个新的 Promise 对象，从而支持链式调用，并且还要将值传递给新 Promise 对象。因此，我们需要对传入的任务函数进行一层额外的包装。"]}],"\n","$L12","\n",["$","p",null,{"children":["包装后的 ",["$","code",null,{"children":"_resolved"}]," 作为真实的任务推送到临时队列中去，而我们在使用时定义的回调函数 ",["$","code",null,{"children":"onResolved"}]," 则在 ",["$","code",null,{"children":"_resolved"}]," 内部执行。并将其执行结果作为新 Promise 对象的 ",["$","code",null,{"children":"resolve"}]," 参数传入。从而满足语法。"]}],"\n",["$","p",null,{"children":"正常情况下定义好的任务应该推送到临时队列中去"}],"\n",["$","p",null,{"children":["不过有一种情况是在定义回调函数 ",["$","code",null,{"children":"onResolved"}]," 时， Promise 就已经有了状态，因此，这种情况下，我们要进行判断，将其直接推入到执行队列。"]}],"\n","$L13","\n",["$","h3",null,{"id":"4-总结","children":[["$","strong",null,{"children":"4、"}]," 总结"]}],"\n",["$","p",null,{"children":["整个代码还是比较清晰易懂，核心的逻辑就是如何管理不同状态的任务，并且明确好任务推送进对应队列的时机，就很容易理解清楚了。这里的关键是我们利用 ",["$","code",null,{"children":"loopRunning"}]," 记录了 ",["$","code",null,{"children":"workLoop"}]," 的执行过程，从而让整个执行流程变得非常巧妙。"]}],"\n",["$","p",null,{"children":["相对而言，Promise 的逻辑会比前面 ",["$","code",null,{"children":"setTimeout"}]," 的逻辑要复杂一点，大家可以多读几遍认真感受。"]}]],null,["$","$L14",null,{"children":"$L15"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","CXlP7V-T5Ak4amGRheYGG",{"children":[["$","$L16",null,{"children":"$L17"}],["$","$L18",null,{"children":"$L19"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}]]}],false]],"m":"$undefined","G":["$1a","$undefined"],"s":false,"S":true}
8:{}
19:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
17:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"usehook - 前端顶级精英俱乐部"}],["$","meta","2",{"name":"description","content":"最好的前端学习网站, react, react19, react hooks, zustand"}],["$","meta","3",{"name":"author","content":"这波能反杀"}],["$","meta","4",{"name":"keywords","content":"react, react19, react hooks, zustand"}],["$","link","5",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]]
15:null
1b:I[34034,["7525","static/chunks/7525-411280bffc37a107.js","4320","static/chunks/4320-eb0b4108191194bc.js","5926","static/chunks/5926-2f921190ce1e6581.js","2794","static/chunks/2794-e7741df2722cee1f.js","8424","static/chunks/app/reactprinciple/(0.eventloop)/6.promise/page-6ea2b695323b3491.js"],"default"]
1c:I[65470,["7525","static/chunks/7525-411280bffc37a107.js","4320","static/chunks/4320-eb0b4108191194bc.js","5926","static/chunks/5926-2f921190ce1e6581.js","2794","static/chunks/2794-e7741df2722cee1f.js","8424","static/chunks/app/reactprinciple/(0.eventloop)/6.promise/page-6ea2b695323b3491.js"],"CodeTabHeader"]
1e:I[65703,["7525","static/chunks/7525-411280bffc37a107.js","4320","static/chunks/4320-eb0b4108191194bc.js","5926","static/chunks/5926-2f921190ce1e6581.js","2794","static/chunks/2794-e7741df2722cee1f.js","8424","static/chunks/app/reactprinciple/(0.eventloop)/6.promise/page-6ea2b695323b3491.js"],"CodeTabsInner"]
a:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"const"}]," ",["$","span","2",{"style":{"color":"var(--ch-2)"},"children":"PromiseJobs"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"[]"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","3,3",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[3,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"let"}]," ",["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"job"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","4,4",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[4,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-1)"},"children":"// 将先进入队列的 job 移出队列，并执行"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","5,5",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[5,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"while"}]," ",["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"(job"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"PromiseJobs."}],["$","span","7",{"style":{"color":"var(--ch-5)"},"children":"shift"}],["$","span","8",{"style":{"color":"var(--ch-4)"},"children":"()) {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","6,6",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[6,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"job"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"()"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","7,7",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[7,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-4)"},"children":"}"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
d:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-1)"},"children":"// 执行队列"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"const"}]," ",["$","span","2",{"style":{"color":"var(--ch-2)"},"children":"promiseJobs"}],["$","span","3",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","5",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"[]"}]," ",["$","span","8",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","10",{"style":{"color":"var(--ch-4)"},"children":"[]"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","3,3",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[3,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","4,4",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[4,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-1)"},"children":"// 临时队列"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","5,5",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[5,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"let"}]," ",["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"PromiseFulfillReactions"}],["$","span","3",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","5",{"style":{"color":"var(--ch-4)"},"children":"{"}],["$","span","6",{"style":{"color":"var(--ch-3)"},"children":"key"}],["$","span","7",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","9",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","10",{"style":{"color":"var(--ch-4)"},"children":","}]," ",["$","span","12",{"style":{"color":"var(--ch-3)"},"children":"callback"}],["$","span","13",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","15",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","16",{"style":{"color":"var(--ch-4)"},"children":"}[]"}]," ",["$","span","18",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","20",{"style":{"color":"var(--ch-4)"},"children":"[]"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","6,6",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[6,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"let"}]," ",["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"PromiseRejectReactions"}],["$","span","3",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","5",{"style":{"color":"var(--ch-4)"},"children":"{"}],["$","span","6",{"style":{"color":"var(--ch-3)"},"children":"key"}],["$","span","7",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","9",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","10",{"style":{"color":"var(--ch-4)"},"children":","}]," ",["$","span","12",{"style":{"color":"var(--ch-3)"},"children":"callback"}],["$","span","13",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","15",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","16",{"style":{"color":"var(--ch-4)"},"children":"}[]"}]," ",["$","span","18",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","20",{"style":{"color":"var(--ch-4)"},"children":"[]"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
e:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-1)"},"children":"// 记录 workLoop 是否已经启动"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"let"}]," ",["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"loopRunning"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-2)"},"children":"false"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
f:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"export default class"}]," ",["$","span","2",{"style":{"color":"var(--ch-3)"},"children":"XPromise {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"private"}]," ",["$","span","3",{"style":{"color":"var(--ch-3)"},"children":"PromiseState"}],["$","span","4",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","6",{"style":{"color":"var(--ch-8)"},"children":"'pending'"}]," ",["$","span","8",{"style":{"color":"var(--ch-7)"},"children":"|"}]," ",["$","span","10",{"style":{"color":"var(--ch-8)"},"children":"'fulfilled'"}]," ",["$","span","12",{"style":{"color":"var(--ch-7)"},"children":"|"}]," ",["$","span","14",{"style":{"color":"var(--ch-8)"},"children":"'rejected'"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","3,3",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[3,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"private"}]," ",["$","span","3",{"style":{"color":"var(--ch-3)"},"children":"PromiseResult"}],["$","span","4",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","6",{"style":{"color":"var(--ch-2)"},"children":"any"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","4,4",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[4,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"constructor"}],["$","span","2",{"style":{"color":"var(--ch-3)"},"children":"("}],["$","span","3",{"style":{"color":"var(--ch-5)"},"children":"executor"}],["$","span","4",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","6",{"style":{"color":"var(--ch-3)"},"children":"("}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","5,5",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[5,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"resolve"}],["$","span","2",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","4",{"style":{"color":"var(--ch-3)"},"children":"(value"}],["$","span","5",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","7",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","8",{"style":{"color":"var(--ch-3)"},"children":")"}]," ",["$","span","10",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","12",{"style":{"color":"var(--ch-2)"},"children":"void"}],["$","span","13",{"style":{"color":"var(--ch-3)"},"children":","}]," ","\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","6,6",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[6,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"reject"}],["$","span","2",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","4",{"style":{"color":"var(--ch-3)"},"children":"(reason"}],["$","span","5",{"style":{"color":"var(--ch-7)"},"children":"?:"}]," ",["$","span","7",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","8",{"style":{"color":"var(--ch-3)"},"children":")"}]," ",["$","span","10",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","12",{"style":{"color":"var(--ch-2)"},"children":"void"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","7,7",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[7,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-3)"},"children":")"}]," ",["$","span","3",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","5",{"style":{"color":"var(--ch-2)"},"children":"void"}],["$","span","6",{"style":{"color":"var(--ch-3)"},"children":")"}]," ",["$","span","8",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","8,8",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[8,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":".PromiseResult"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-2)"},"children":"undefined"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","9,9",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[9,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":".PromiseState"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"pending"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","10,10",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[10,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","11,11",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[11,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"executor"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"("}],["$","span","3",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","4",{"style":{"color":"var(--ch-4)"},"children":".resolve."}],["$","span","5",{"style":{"color":"var(--ch-5)"},"children":"bind"}],["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"("}],["$","span","7",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","8",{"style":{"color":"var(--ch-4)"},"children":"),"}]," ",["$","span","10",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","11",{"style":{"color":"var(--ch-4)"},"children":".resolve."}],["$","span","12",{"style":{"color":"var(--ch-5)"},"children":"bind"}],["$","span","13",{"style":{"color":"var(--ch-4)"},"children":"("}],["$","span","14",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","15",{"style":{"color":"var(--ch-4)"},"children":"))"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","12,12",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[12,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","13,13",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[13,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-3)"},"children":"}"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
10:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-5)"},"children":"resolve"}]," ",["$","span","2",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","4",{"style":{"color":"var(--ch-4)"},"children":"("}],["$","span","5",{"style":{"color":"var(--ch-3)"},"children":"value"}],["$","span","6",{"style":{"color":"var(--ch-7)"},"children":":"}]," ",["$","span","8",{"style":{"color":"var(--ch-2)"},"children":"any"}],["$","span","9",{"style":{"color":"var(--ch-4)"},"children":")"}]," ",["$","span","11",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","13",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-1)"},"children":"// 推送到执行队列，或者启动执行队列的循环"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","3,3",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[3,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":".PromiseResult"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"value"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","4,4",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[4,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":".PromiseState"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"fulfilled"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","5,5",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[5,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","6,6",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[6,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"const"}]," ",["$","span","3",{"style":{"color":"var(--ch-2)"},"children":"job"}]," ",["$","span","5",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","7",{"style":{"color":"var(--ch-4)"},"children":"PromiseFulfillReactions."}],["$","span","8",{"style":{"color":"var(--ch-5)"},"children":"find"}],["$","span","9",{"style":{"color":"var(--ch-4)"},"children":"(("}],["$","span","10",{"style":{"color":"var(--ch-3)"},"children":"item"}],["$","span","11",{"style":{"color":"var(--ch-4)"},"children":")"}]," ",["$","span","13",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","15",{"style":{"color":"var(--ch-4)"},"children":"item.key"}]," ",["$","span","17",{"style":{"color":"var(--ch-7)"},"children":"==="}]," ",["$","span","19",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","20",{"style":{"color":"var(--ch-4)"},"children":")"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","7,7",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[7,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"if"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"(job) {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","8,8",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[8,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"PromiseFulfillReactions"}]," ",["$","span","3",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","5",{"style":{"color":"var(--ch-4)"},"children":"PromiseFulfillReactions."}],["$","span","6",{"style":{"color":"var(--ch-5)"},"children":"filter"}],["$","span","7",{"style":{"color":"var(--ch-4)"},"children":"("}],["$","span","8",{"style":{"color":"var(--ch-3)"},"children":"item"}]," ",["$","span","10",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","12",{"style":{"color":"var(--ch-4)"},"children":"item.key"}]," ",["$","span","14",{"style":{"color":"var(--ch-7)"},"children":"!=="}]," ",["$","span","16",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","17",{"style":{"color":"var(--ch-4)"},"children":")"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","9,9",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[9,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"promiseJobs."}],["$","span","2",{"style":{"color":"var(--ch-5)"},"children":"push"}],["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"(job.callback)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","10,10",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[10,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","11,11",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[11,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-1)"},"children":"// 如果 workLoop 没有启动，则启动 workLoop"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","12,12",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[12,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"if"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"(loopRunning"}]," ",["$","span","5",{"style":{"color":"var(--ch-7)"},"children":"==="}]," ",["$","span","7",{"style":{"color":"var(--ch-2)"},"children":"false"}],["$","span","8",{"style":{"color":"var(--ch-4)"},"children":") {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","13,13",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[13,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"loopRunning"}]," ",["$","span","3",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","5",{"style":{"color":"var(--ch-2)"},"children":"true"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","14,14",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[14,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"."}],["$","span","3",{"style":{"color":"var(--ch-5)"},"children":"workLoop"}],["$","span","4",{"style":{"color":"var(--ch-4)"},"children":"()"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","15,15",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[15,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","16,16",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[16,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-4)"},"children":"}"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
11:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-5)"},"children":"workLoop"}]," ",["$","span","2",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","4",{"style":{"color":"var(--ch-4)"},"children":"()"}]," ",["$","span","6",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","8",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"setTimeout"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"(()"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","3,3",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[3,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"let"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"cb"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","4,4",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[4,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"while"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"(cb"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"promiseJobs."}],["$","span","7",{"style":{"color":"var(--ch-5)"},"children":"shift"}],["$","span","8",{"style":{"color":"var(--ch-4)"},"children":"()) {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","5,5",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[5,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"cb"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"()"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","6,6",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[6,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","7,7",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[7,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"loopRunning"}]," ",["$","span","3",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","5",{"style":{"color":"var(--ch-2)"},"children":"false"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","8,8",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[8,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"},"}]," ",["$","span","3",{"style":{"color":"var(--ch-2)"},"children":"0"}],["$","span","4",{"style":{"color":"var(--ch-4)"},"children":")"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","9,9",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[9,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-4)"},"children":"}"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
12:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"const"}]," ",["$","span","2",{"style":{"color":"var(--ch-5)"},"children":"_resolved"}]," ",["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"()"}]," ",["$","span","8",{"style":{"color":"var(--ch-7)"},"children":"=>"}]," ",["$","span","10",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"const"}]," ",["$","span","3",{"style":{"color":"var(--ch-2)"},"children":"value"}]," ",["$","span","5",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","7",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","8",{"style":{"color":"var(--ch-4)"},"children":".PromiseResult"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","3,3",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[3,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"try"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","4,4",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[4,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"if"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"("}],["$","span","4",{"style":{"color":"var(--ch-7)"},"children":"!"}],["$","span","5",{"style":{"color":"var(--ch-5)"},"children":"isFunction"}],["$","span","6",{"style":{"color":"var(--ch-4)"},"children":"(onResolved)) {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","5,5",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[5,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"resolveNext"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"(value)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","6,6",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[6,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}]," ",["$","span","3",{"style":{"color":"var(--ch-7)"},"children":"else"}]," ",["$","span","5",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","7,7",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[7,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"const"}]," ",["$","span","3",{"style":{"color":"var(--ch-2)"},"children":"res"}]," ",["$","span","5",{"style":{"color":"var(--ch-7)"},"children":"="}]," ",["$","span","7",{"style":{"color":"var(--ch-5)"},"children":"onResolved"}],["$","span","8",{"style":{"color":"var(--ch-4)"},"children":"(value)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","8,8",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[8,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"if"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"(res"}]," ",["$","span","5",{"style":{"color":"var(--ch-7)"},"children":"instanceof"}]," ",["$","span","7",{"style":{"color":"var(--ch-3)"},"children":"XPromise"}],["$","span","8",{"style":{"color":"var(--ch-4)"},"children":") {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","9,9",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[9,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["        ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"res."}],["$","span","2",{"style":{"color":"var(--ch-5)"},"children":"then"}],["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"(resolveNext, rejectNext)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","10,10",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[10,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}]," ",["$","span","3",{"style":{"color":"var(--ch-7)"},"children":"else"}]," ",["$","span","5",{"style":{"color":"var(--ch-4)"},"children":"{"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","11,11",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[11,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["        ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"resolveNext"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"(res)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","12,12",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[12,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}],"  ","\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","13,13",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[13,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","14,14",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[14,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}]," ",["$","span","3",{"style":{"color":"var(--ch-7)"},"children":"catch"}]," ",["$","span","5",{"style":{"color":"var(--ch-4)"},"children":"(err) {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","15,15",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[15,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-5)"},"children":"rejectNext"}],["$","span","2",{"style":{"color":"var(--ch-4)"},"children":"(err)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","16,16",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[16,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"}"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","17,17",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[17,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-4)"},"children":"}"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
13:["$","div",null,{"className":"code-wrapper border my-4 border-gray-200 rounded overflow-hidden","children":[null,["$","div",null,{"className":"code-base typescript","children":[false,["$","pre",null,{"data-theme":"github-from-css","data-lang":"typescript","ref":"$undefined","data-ch":true,"children":["$","div",null,{"style":{"minWidth":"fit-content"},"children":[["$","div","1,1",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[1,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-7)"},"children":"switch"}],["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"("}],["$","span","2",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","3",{"style":{"color":"var(--ch-4)"},"children":".PromiseState) {"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","2,2",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[2,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-1)"},"children":"// 状态为 pending 时，收集回调"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","3,3",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[3,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"case"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"pending:"}]," ","\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","4,4",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[4,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"PromiseFulfillReactions."}],["$","span","2",{"style":{"color":"var(--ch-5)"},"children":"push"}],["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"({"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","5,5",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[5,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"key:"}]," ",["$","span","3",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","4",{"style":{"color":"var(--ch-4)"},"children":","}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","6,6",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[6,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"callback: _resolved"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","7,7",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[7,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"})"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","8,8",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[8,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"PromiseRejectReactions."}],["$","span","2",{"style":{"color":"var(--ch-5)"},"children":"push"}],["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"({"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","9,9",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[9,["$","span",null,{"className":"invisible","children":"0"}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"key:"}]," ",["$","span","3",{"style":{"color":"var(--ch-2)"},"children":"this"}],["$","span","4",{"style":{"color":"var(--ch-4)"},"children":","}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","10,10",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[10,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["      ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"callback: _rejected"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","11,11",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[11,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"})"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","12,12",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[12,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"break"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","13,13",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[13,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-1)"},"children":"// 状态已经改变了，就直接执行回调"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","14,14",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[14,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"case"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"fulfilled:"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","15,15",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[15,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"promiseJobs."}],["$","span","2",{"style":{"color":"var(--ch-5)"},"children":"push"}],["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"(_resolved)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","16,16",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[16,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"break"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","17,17",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[17,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["  ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"case"}]," ",["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"rejected:"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","18,18",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[18,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-4)"},"children":"promiseJobs."}],["$","span","2",{"style":{"color":"var(--ch-5)"},"children":"push"}],["$","span","3",{"style":{"color":"var(--ch-4)"},"children":"(_rejected)"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","19,19",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[19,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":["    ",["$","span","1",{"style":{"color":"var(--ch-7)"},"children":"break"}],"\n"],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}],["$","div","20,20",{"style":{"borderLeft":"solid 2px transparent","borderLeftColor":"$undefined","backgroundColor":"$undefined"},"className":"flex","children":["$","div",null,{"className":"flex items-center","children":[["$","span",null,{"className":"line-number px-4 text-gray-400 text-xs select-none","children":["$","span",null,{"children":[20,["$","span",null,{"className":"invisible","children":""}]]}]}],["$","div",null,{"children":[["$","span","0",{"style":{"color":"var(--ch-4)"},"children":"}"}]],"className":"px-2 flex-1 flex-1 pl-2"}]]}]}]]}]}]]}]]}]
1d:Td41,const pending = 'pending'
const fulfilled = 'fulfilled'
const rejected = 'rejected'

let loopRunning = false

const promiseJobs: any[] = []

let PromiseFulfillReactions: {key: any, callback: any}[] = []
let PromiseRejectReactions: {key: any, callback: any}[] = []

const isFunction = (fn: any) => typeof fn === 'function'

export default class XPromise {
  private PromiseState: 'pending' | 'fulfilled' | 'rejected'
  private PromiseResult: any
  constructor(executor: (
    resolve: (value: any) => void, 
    reject: (reason?: any) => void
  ) => void) {
    this.PromiseResult = undefined
    this.PromiseState = pending

    executor(this.resolve.bind(this), this.reject.bind(this))
  }

  resolve = (value: any) => {
    // 推送到执行队列，或者启动执行队列的循环
    this.PromiseResult = value
    this.PromiseState = fulfilled

    const job = PromiseFulfillReactions.find((item) => item.key === this)
    if (job) {
      PromiseFulfillReactions = PromiseFulfillReactions.filter(item => item.key !== this)
      promiseJobs.push(job.callback)
    }
    if (loopRunning === false) {
      loopRunning = true
      this.workLoop()
    }
  }

  reject(value: any) {
    this.PromiseResult = value
    this.PromiseState = rejected
    const job = PromiseRejectReactions.find(item => item.key === this)
    
    if (job) {
      PromiseRejectReactions = PromiseRejectReactions.filter(item => item.key !== this)
      promiseJobs.push(job.callback)
    }
    if (loopRunning === false) {
      loopRunning = true
      this.workLoop()
    }
  }

  then = (onResolved: any, onRejected?: any) => {
    return new XPromise((resolveNext, rejectNext) => {
      const _resolved = () => {
        const value = this.PromiseResult
        try {
          if (!isFunction(onResolved)) {
            resolveNext(value)
          } else {
            const res = onResolved(value)
            if (res instanceof XPromise) {
              res.then(resolveNext, rejectNext)
            } else {
              resolveNext(res)
            }  
          }
        } catch (err) {
          rejectNext(err)
        }
      }

      const _rejected = () => {
        const value = this.PromiseResult
        try {
          if (!isFunction(onRejected)) {
            rejectNext(value)
          } else {
            const res = onRejected(value)
            if (res instanceof XPromise) {
              res.then(resolveNext, rejectNext)
            } else {
              resolveNext(res)
            }
          }
        } catch (err) {
          rejectNext(err)
        }
      }
      switch(this.PromiseState) {
        // 状态为 pending 时，收集回调
        case pending: 
          PromiseFulfillReactions.push({
            key: this,
            callback: _resolved
          })
          PromiseRejectReactions.push({
            key: this,
            callback: _rejected
          })
          break
        // 状态已经改变了，就直接执行回调
        case fulfilled:
          promiseJobs.push(_resolved)
          break
        case rejected:
          promiseJobs.push(_rejected)
          break
      }
    })
  }

  workLoop = () => {
    setTimeout(() => {
      let cb
      while(cb = promiseJobs.shift()) {
        cb()
      }
      loopRunning = false
    }, 0)
  }

  catch = (onRejected: any) => {
    return this.then(null, onRejected)
  }
}1f:Td41,const pending = 'pending'
const fulfilled = 'fulfilled'
const rejected = 'rejected'

let loopRunning = false

const promiseJobs: any[] = []

let PromiseFulfillReactions: {key: any, callback: any}[] = []
let PromiseRejectReactions: {key: any, callback: any}[] = []

const isFunction = (fn: any) => typeof fn === 'function'

export default class XPromise {
  private PromiseState: 'pending' | 'fulfilled' | 'rejected'
  private PromiseResult: any
  constructor(executor: (
    resolve: (value: any) => void, 
    reject: (reason?: any) => void
  ) => void) {
    this.PromiseResult = undefined
    this.PromiseState = pending

    executor(this.resolve.bind(this), this.reject.bind(this))
  }

  resolve = (value: any) => {
    // 推送到执行队列，或者启动执行队列的循环
    this.PromiseResult = value
    this.PromiseState = fulfilled

    const job = PromiseFulfillReactions.find((item) => item.key === this)
    if (job) {
      PromiseFulfillReactions = PromiseFulfillReactions.filter(item => item.key !== this)
      promiseJobs.push(job.callback)
    }
    if (loopRunning === false) {
      loopRunning = true
      this.workLoop()
    }
  }

  reject(value: any) {
    this.PromiseResult = value
    this.PromiseState = rejected
    const job = PromiseRejectReactions.find(item => item.key === this)
    
    if (job) {
      PromiseRejectReactions = PromiseRejectReactions.filter(item => item.key !== this)
      promiseJobs.push(job.callback)
    }
    if (loopRunning === false) {
      loopRunning = true
      this.workLoop()
    }
  }

  then = (onResolved: any, onRejected?: any) => {
    return new XPromise((resolveNext, rejectNext) => {
      const _resolved = () => {
        const value = this.PromiseResult
        try {
          if (!isFunction(onResolved)) {
            resolveNext(value)
          } else {
            const res = onResolved(value)
            if (res instanceof XPromise) {
              res.then(resolveNext, rejectNext)
            } else {
              resolveNext(res)
            }  
          }
        } catch (err) {
          rejectNext(err)
        }
      }

      const _rejected = () => {
        const value = this.PromiseResult
        try {
          if (!isFunction(onRejected)) {
            rejectNext(value)
          } else {
            const res = onRejected(value)
            if (res instanceof XPromise) {
              res.then(resolveNext, rejectNext)
            } else {
              resolveNext(res)
            }
          }
        } catch (err) {
          rejectNext(err)
        }
      }
      switch(this.PromiseState) {
        // 状态为 pending 时，收集回调
        case pending: 
          PromiseFulfillReactions.push({
            key: this,
            callback: _resolved
          })
          PromiseRejectReactions.push({
            key: this,
            callback: _rejected
          })
          break
        // 状态已经改变了，就直接执行回调
        case fulfilled:
          promiseJobs.push(_resolved)
          break
        case rejected:
          promiseJobs.push(_rejected)
          break
      }
    })
  }

  workLoop = () => {
    setTimeout(() => {
      let cb
      while(cb = promiseJobs.shift()) {
        cb()
      }
      loopRunning = false
    }, 0)
  }

  catch = (onRejected: any) => {
    return this.then(null, onRejected)
  }
}20:Td41,const pending = 'pending'
const fulfilled = 'fulfilled'
const rejected = 'rejected'

let loopRunning = false

const promiseJobs: any[] = []

let PromiseFulfillReactions: {key: any, callback: any}[] = []
let PromiseRejectReactions: {key: any, callback: any}[] = []

const isFunction = (fn: any) => typeof fn === 'function'

export default class XPromise {
  private PromiseState: 'pending' | 'fulfilled' | 'rejected'
  private PromiseResult: any
  constructor(executor: (
    resolve: (value: any) => void, 
    reject: (reason?: any) => void
  ) => void) {
    this.PromiseResult = undefined
    this.PromiseState = pending

    executor(this.resolve.bind(this), this.reject.bind(this))
  }

  resolve = (value: any) => {
    // 推送到执行队列，或者启动执行队列的循环
    this.PromiseResult = value
    this.PromiseState = fulfilled

    const job = PromiseFulfillReactions.find((item) => item.key === this)
    if (job) {
      PromiseFulfillReactions = PromiseFulfillReactions.filter(item => item.key !== this)
      promiseJobs.push(job.callback)
    }
    if (loopRunning === false) {
      loopRunning = true
      this.workLoop()
    }
  }

  reject(value: any) {
    this.PromiseResult = value
    this.PromiseState = rejected
    const job = PromiseRejectReactions.find(item => item.key === this)
    
    if (job) {
      PromiseRejectReactions = PromiseRejectReactions.filter(item => item.key !== this)
      promiseJobs.push(job.callback)
    }
    if (loopRunning === false) {
      loopRunning = true
      this.workLoop()
    }
  }

  then = (onResolved: any, onRejected?: any) => {
    return new XPromise((resolveNext, rejectNext) => {
      const _resolved = () => {
        const value = this.PromiseResult
        try {
          if (!isFunction(onResolved)) {
            resolveNext(value)
          } else {
            const res = onResolved(value)
            if (res instanceof XPromise) {
              res.then(resolveNext, rejectNext)
            } else {
              resolveNext(res)
            }  
          }
        } catch (err) {
          rejectNext(err)
        }
      }

      const _rejected = () => {
        const value = this.PromiseResult
        try {
          if (!isFunction(onRejected)) {
            rejectNext(value)
          } else {
            const res = onRejected(value)
            if (res instanceof XPromise) {
              res.then(resolveNext, rejectNext)
            } else {
              resolveNext(res)
            }
          }
        } catch (err) {
          rejectNext(err)
        }
      }
      switch(this.PromiseState) {
        // 状态为 pending 时，收集回调
        case pending: 
          PromiseFulfillReactions.push({
            key: this,
            callback: _resolved
          })
          PromiseRejectReactions.push({
            key: this,
            callback: _rejected
          })
          break
        // 状态已经改变了，就直接执行回调
        case fulfilled:
          promiseJobs.push(_resolved)
          break
        case rejected:
          promiseJobs.push(_rejected)
          break
      }
    })
  }

  workLoop = () => {
    setTimeout(() => {
      let cb
      while(cb = promiseJobs.shift()) {
        cb()
      }
      loopRunning = false
    }, 0)
  }

  catch = (onRejected: any) => {
    return this.then(null, onRejected)
  }
}c:["$","div",null,{"className":"code-tabs border rounded border-gray-200 overflow-hidden my-5","children":["$","$L1b",null,{"children":[["$","$L1c",null,{"tabs":[{"meta":"index.tsx -c","value":"import Button from 'components/ui/button'\nimport XPromise from './promise'\n\nexport default function Counter() {\n  function __click() {\n    new XPromise((resolve) => {\n      setTimeout(() => {\n        resolve('hello xpromise')\n      }, 1000)\n    }).then((value: any) => {\n      console.log('5. Value: ', value)\n    }).then(() => {\n      console.log('6')\n    })\n\n    new XPromise(resolve => {\n      resolve('')\n    }).then(() => {\n      console.log('1')\n      new XPromise(resolve => {\n        resolve('')\n      }).then(() => {\n        console.log('2')\n      }).then(() => {\n        console.log('4')\n      })\n    }).then(() => {\n      console.log('3')\n    })\n\n    console.log('0')\n  }\n  return (\n    <div className=''>\n      <Button onClick={__click}>执行 XPromise 任务</Button>\n    </div>\n  )\n}","lang":"tsx"},{"meta":"promise.ts -c","value":"$1d","lang":"tsx"}]}],["$","$L1e",null,{"highlighteds":[{"meta":"index.tsx -c","value":"import Button from 'components/ui/button'\nimport XPromise from './promise'\n\nexport default function Counter() {\n  function __click() {\n    new XPromise((resolve) => {\n      setTimeout(() => {\n        resolve('hello xpromise')\n      }, 1000)\n    }).then((value: any) => {\n      console.log('5. Value: ', value)\n    }).then(() => {\n      console.log('6')\n    })\n\n    new XPromise(resolve => {\n      resolve('')\n    }).then(() => {\n      console.log('1')\n      new XPromise(resolve => {\n        resolve('')\n      }).then(() => {\n        console.log('2')\n      }).then(() => {\n        console.log('4')\n      })\n    }).then(() => {\n      console.log('3')\n    })\n\n    console.log('0')\n  }\n  return (\n    <div className=''>\n      <Button onClick={__click}>执行 XPromise 任务</Button>\n    </div>\n  )\n}","lang":"tsx","code":"import Button from 'components/ui/button'\nimport XPromise from './promise'\n\nexport default function Counter() {\n  function __click() {\n    new XPromise((resolve) => {\n      setTimeout(() => {\n        resolve('hello xpromise')\n      }, 1000)\n    }).then((value: any) => {\n      console.log('5. Value: ', value)\n    }).then(() => {\n      console.log('6')\n    })\n\n    new XPromise(resolve => {\n      resolve('')\n    }).then(() => {\n      console.log('1')\n      new XPromise(resolve => {\n        resolve('')\n      }).then(() => {\n        console.log('2')\n      }).then(() => {\n        console.log('4')\n      })\n    }).then(() => {\n      console.log('3')\n    })\n\n    console.log('0')\n  }\n  return (\n    <div className=''>\n      <Button onClick={__click}>执行 XPromise 任务</Button>\n    </div>\n  )\n}","tokens":[["import","var(--ch-7)"]," ",["Button","var(--ch-4)"]," ",["from","var(--ch-7)"]," ",["'components/ui/button'","var(--ch-8)"],"\n",["import","var(--ch-7)"]," ",["XPromise","var(--ch-4)"]," ",["from","var(--ch-7)"]," ",["'./promise'","var(--ch-8)"],"\n\n",["export default function","var(--ch-7)"]," ",["Counter","var(--ch-5)"],["()","var(--ch-3)"]," ",["{","var(--ch-4)"],"\n  ",["function","var(--ch-7)"]," ",["__click","var(--ch-5)"],["() {","var(--ch-4)"],"\n    ",["new","var(--ch-7)"]," ",["XPromise","var(--ch-5)"],["((","var(--ch-4)"],["resolve","var(--ch-3)"],[")","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["setTimeout","var(--ch-5)"],["(()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n        ",["resolve","var(--ch-5)"],["(","var(--ch-4)"],["'hello xpromise'","var(--ch-8)"],[")","var(--ch-4)"],"\n      ",["},","var(--ch-4)"]," ",["1000","var(--ch-2)"],[")","var(--ch-4)"],"\n    ",["}).","var(--ch-4)"],["then","var(--ch-5)"],["((","var(--ch-4)"],["value","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["console.","var(--ch-4)"],["log","var(--ch-5)"],["(","var(--ch-4)"],["'5. Value: '","var(--ch-8)"],[", value)","var(--ch-4)"],"\n    ",["}).","var(--ch-4)"],["then","var(--ch-5)"],["(()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["console.","var(--ch-4)"],["log","var(--ch-5)"],["(","var(--ch-4)"],["'6'","var(--ch-8)"],[")","var(--ch-4)"],"\n    ",["})","var(--ch-4)"],"\n\n    ",["new","var(--ch-7)"]," ",["XPromise","var(--ch-5)"],["(","var(--ch-4)"],["resolve","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["resolve","var(--ch-5)"],["(","var(--ch-4)"],["''","var(--ch-8)"],[")","var(--ch-4)"],"\n    ",["}).","var(--ch-4)"],["then","var(--ch-5)"],["(()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["console.","var(--ch-4)"],["log","var(--ch-5)"],["(","var(--ch-4)"],["'1'","var(--ch-8)"],[")","var(--ch-4)"],"\n      ",["new","var(--ch-7)"]," ",["XPromise","var(--ch-5)"],["(","var(--ch-4)"],["resolve","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n        ",["resolve","var(--ch-5)"],["(","var(--ch-4)"],["''","var(--ch-8)"],[")","var(--ch-4)"],"\n      ",["}).","var(--ch-4)"],["then","var(--ch-5)"],["(()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n        ",["console.","var(--ch-4)"],["log","var(--ch-5)"],["(","var(--ch-4)"],["'2'","var(--ch-8)"],[")","var(--ch-4)"],"\n      ",["}).","var(--ch-4)"],["then","var(--ch-5)"],["(()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n        ",["console.","var(--ch-4)"],["log","var(--ch-5)"],["(","var(--ch-4)"],["'4'","var(--ch-8)"],[")","var(--ch-4)"],"\n      ",["})","var(--ch-4)"],"\n    ",["}).","var(--ch-4)"],["then","var(--ch-5)"],["(()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["console.","var(--ch-4)"],["log","var(--ch-5)"],["(","var(--ch-4)"],["'3'","var(--ch-8)"],[")","var(--ch-4)"],"\n    ",["})","var(--ch-4)"],"\n\n    ",["console.","var(--ch-4)"],["log","var(--ch-5)"],["(","var(--ch-4)"],["'0'","var(--ch-8)"],[")","var(--ch-4)"],"\n  ",["}","var(--ch-4)"],"\n  ",["return","var(--ch-7)"]," ",["(","var(--ch-4)"],"\n    ",["<","var(--ch-4)"],["div","var(--ch-6)"]," ",["className","var(--ch-2)"],["=","var(--ch-7)"],["''","var(--ch-8)"],[">","var(--ch-4)"],"\n      ",["<","var(--ch-4)"],["Button","var(--ch-6)"]," ",["onClick","var(--ch-2)"],["={","var(--ch-7)"],["__click","var(--ch-4)"],["}","var(--ch-7)"],[">执行 XPromise 任务</","var(--ch-4)"],["Button","var(--ch-6)"],[">","var(--ch-4)"],"\n    ",["</","var(--ch-4)"],["div","var(--ch-6)"],[">","var(--ch-4)"],"\n  ",[")","var(--ch-4)"],"\n",["}","var(--ch-4)"]],"annotations":[],"themeName":"github-from-css","style":{"color":"var(--ch-4)","background":"var(--ch-16)","colorScheme":"var(--ch-0)"}},{"meta":"promise.ts -c","value":"$1f","lang":"tsx","code":"$20","tokens":[["const","var(--ch-7)"]," ",["pending","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["'pending'","var(--ch-8)"],"\n",["const","var(--ch-7)"]," ",["fulfilled","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["'fulfilled'","var(--ch-8)"],"\n",["const","var(--ch-7)"]," ",["rejected","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["'rejected'","var(--ch-8)"],"\n\n",["let","var(--ch-7)"]," ",["loopRunning","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["false","var(--ch-2)"],"\n\n",["const","var(--ch-7)"]," ",["promiseJobs","var(--ch-2)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],["[]","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["[]","var(--ch-4)"],"\n\n",["let","var(--ch-7)"]," ",["PromiseFulfillReactions","var(--ch-4)"],[":","var(--ch-7)"]," ",["{","var(--ch-4)"],["key","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[",","var(--ch-4)"]," ",["callback","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],["}[]","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["[]","var(--ch-4)"],"\n",["let","var(--ch-7)"]," ",["PromiseRejectReactions","var(--ch-4)"],[":","var(--ch-7)"]," ",["{","var(--ch-4)"],["key","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[",","var(--ch-4)"]," ",["callback","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],["}[]","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["[]","var(--ch-4)"],"\n\n",["const","var(--ch-7)"]," ",["isFunction","var(--ch-5)"]," ",["=","var(--ch-7)"]," ",["(","var(--ch-4)"],["fn","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-4)"]," ",["=> typeof","var(--ch-7)"]," ",["fn","var(--ch-4)"]," ",["===","var(--ch-7)"]," ",["'function'","var(--ch-8)"],"\n\n",["export default class","var(--ch-7)"]," ",["XPromise {","var(--ch-3)"],"\n  ",["private","var(--ch-7)"]," ",["PromiseState","var(--ch-3)"],[":","var(--ch-7)"]," ",["'pending'","var(--ch-8)"]," ",["|","var(--ch-7)"]," ",["'fulfilled'","var(--ch-8)"]," ",["|","var(--ch-7)"]," ",["'rejected'","var(--ch-8)"],"\n  ",["private","var(--ch-7)"]," ",["PromiseResult","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],"\n  ",["constructor","var(--ch-7)"],["(","var(--ch-3)"],["executor","var(--ch-5)"],[":","var(--ch-7)"]," ",["(","var(--ch-3)"],"\n    ",["resolve","var(--ch-5)"],[":","var(--ch-7)"]," ",["(value","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["void","var(--ch-2)"],[",","var(--ch-3)"]," \n    ",["reject","var(--ch-5)"],[":","var(--ch-7)"]," ",["(reason","var(--ch-3)"],["?:","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["void","var(--ch-2)"],"\n  ",[")","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["void","var(--ch-2)"],[")","var(--ch-3)"]," ",["{","var(--ch-4)"],"\n    ",["this","var(--ch-2)"],[".PromiseResult","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["undefined","var(--ch-2)"],"\n    ",["this","var(--ch-2)"],[".PromiseState","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["pending","var(--ch-4)"],"\n\n    ",["executor","var(--ch-5)"],["(","var(--ch-4)"],["this","var(--ch-2)"],[".resolve.","var(--ch-4)"],["bind","var(--ch-5)"],["(","var(--ch-4)"],["this","var(--ch-2)"],["),","var(--ch-4)"]," ",["this","var(--ch-2)"],[".reject.","var(--ch-4)"],["bind","var(--ch-5)"],["(","var(--ch-4)"],["this","var(--ch-2)"],["))","var(--ch-4)"],"\n  ",["}","var(--ch-4)"],"\n\n  ",["resolve","var(--ch-5)"]," ",["=","var(--ch-7)"]," ",["(value","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n    ",["// 推送到执行队列，或者启动执行队列的循环","var(--ch-1)"],"\n    ",["this","var(--ch-2)"],[".PromiseResult","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["value","var(--ch-4)"],"\n    ",["this","var(--ch-2)"],[".PromiseState","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["fulfilled","var(--ch-4)"],"\n\n    ",["const","var(--ch-7)"]," ",["job","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["PromiseFulfillReactions.","var(--ch-4)"],["find","var(--ch-5)"],["((","var(--ch-4)"],["item","var(--ch-3)"],[")","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["item.key","var(--ch-4)"]," ",["===","var(--ch-7)"]," ",["this","var(--ch-2)"],[")","var(--ch-4)"],"\n    ",["if","var(--ch-7)"]," ",["(job) {","var(--ch-4)"],"\n      ",["PromiseFulfillReactions","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["PromiseFulfillReactions.","var(--ch-4)"],["filter","var(--ch-5)"],["(","var(--ch-4)"],["item","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["item.key","var(--ch-4)"]," ",["!==","var(--ch-7)"]," ",["this","var(--ch-2)"],[")","var(--ch-4)"],"\n      ",["promiseJobs.","var(--ch-4)"],["push","var(--ch-5)"],["(job.callback)","var(--ch-4)"],"\n    ",["}","var(--ch-4)"],"\n    ",["if","var(--ch-7)"]," ",["(loopRunning","var(--ch-4)"]," ",["===","var(--ch-7)"]," ",["false","var(--ch-2)"],[") {","var(--ch-4)"],"\n      ",["loopRunning","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["true","var(--ch-2)"],"\n      ",["this","var(--ch-2)"],[".","var(--ch-4)"],["workLoop","var(--ch-5)"],["()","var(--ch-4)"],"\n    ",["}","var(--ch-4)"],"\n  ",["}","var(--ch-4)"],"\n\n  ",["reject","var(--ch-5)"],["(value","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-3)"]," ",["{","var(--ch-4)"],"\n    ",["this","var(--ch-2)"],[".PromiseResult","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["value","var(--ch-4)"],"\n    ",["this","var(--ch-2)"],[".PromiseState","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["rejected","var(--ch-4)"],"\n    ",["const","var(--ch-7)"]," ",["job","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["PromiseRejectReactions.","var(--ch-4)"],["find","var(--ch-5)"],["(","var(--ch-4)"],["item","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["item.key","var(--ch-4)"]," ",["===","var(--ch-7)"]," ",["this","var(--ch-2)"],[")","var(--ch-4)"],"\n    \n    ",["if","var(--ch-7)"]," ",["(job) {","var(--ch-4)"],"\n      ",["PromiseRejectReactions","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["PromiseRejectReactions.","var(--ch-4)"],["filter","var(--ch-5)"],["(","var(--ch-4)"],["item","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["item.key","var(--ch-4)"]," ",["!==","var(--ch-7)"]," ",["this","var(--ch-2)"],[")","var(--ch-4)"],"\n      ",["promiseJobs.","var(--ch-4)"],["push","var(--ch-5)"],["(job.callback)","var(--ch-4)"],"\n    ",["}","var(--ch-4)"],"\n    ",["if","var(--ch-7)"]," ",["(loopRunning","var(--ch-4)"]," ",["===","var(--ch-7)"]," ",["false","var(--ch-2)"],[") {","var(--ch-4)"],"\n      ",["loopRunning","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["true","var(--ch-2)"],"\n      ",["this","var(--ch-2)"],[".","var(--ch-4)"],["workLoop","var(--ch-5)"],["()","var(--ch-4)"],"\n    ",["}","var(--ch-4)"],"\n  ",["}","var(--ch-4)"],"\n\n  ",["then","var(--ch-5)"]," ",["=","var(--ch-7)"]," ",["(onResolved","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[", onRejected","var(--ch-3)"],["?:","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n    ",["return new","var(--ch-7)"]," ",["XPromise","var(--ch-5)"],["((","var(--ch-4)"],["resolveNext","var(--ch-3)"],[",","var(--ch-4)"]," ",["rejectNext","var(--ch-3)"],[")","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["const","var(--ch-7)"]," ",["_resolved","var(--ch-5)"]," ",["=","var(--ch-7)"]," ",["()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n        ",["const","var(--ch-7)"]," ",["value","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["this","var(--ch-2)"],[".PromiseResult","var(--ch-4)"],"\n        ",["try","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n          ",["if","var(--ch-7)"]," ",["(","var(--ch-4)"],["!","var(--ch-7)"],["isFunction","var(--ch-5)"],["(onResolved)) {","var(--ch-4)"],"\n            ",["resolveNext","var(--ch-5)"],["(value)","var(--ch-4)"],"\n          ",["}","var(--ch-4)"]," ",["else","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n            ",["const","var(--ch-7)"]," ",["res","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["onResolved","var(--ch-5)"],["(value)","var(--ch-4)"],"\n            ",["if","var(--ch-7)"]," ",["(res","var(--ch-4)"]," ",["instanceof","var(--ch-7)"]," ",["XPromise","var(--ch-3)"],[") {","var(--ch-4)"],"\n              ",["res.","var(--ch-4)"],["then","var(--ch-5)"],["(resolveNext, rejectNext)","var(--ch-4)"],"\n            ",["}","var(--ch-4)"]," ",["else","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n              ",["resolveNext","var(--ch-5)"],["(res)","var(--ch-4)"],"\n            ",["}","var(--ch-4)"],"  \n          ",["}","var(--ch-4)"],"\n        ",["}","var(--ch-4)"]," ",["catch","var(--ch-7)"]," ",["(err) {","var(--ch-4)"],"\n          ",["rejectNext","var(--ch-5)"],["(err)","var(--ch-4)"],"\n        ",["}","var(--ch-4)"],"\n      ",["}","var(--ch-4)"],"\n\n      ",["const","var(--ch-7)"]," ",["_rejected","var(--ch-5)"]," ",["=","var(--ch-7)"]," ",["()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n        ",["const","var(--ch-7)"]," ",["value","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["this","var(--ch-2)"],[".PromiseResult","var(--ch-4)"],"\n        ",["try","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n          ",["if","var(--ch-7)"]," ",["(","var(--ch-4)"],["!","var(--ch-7)"],["isFunction","var(--ch-5)"],["(onRejected)) {","var(--ch-4)"],"\n            ",["rejectNext","var(--ch-5)"],["(value)","var(--ch-4)"],"\n          ",["}","var(--ch-4)"]," ",["else","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n            ",["const","var(--ch-7)"]," ",["res","var(--ch-2)"]," ",["=","var(--ch-7)"]," ",["onRejected","var(--ch-5)"],["(value)","var(--ch-4)"],"\n            ",["if","var(--ch-7)"]," ",["(res","var(--ch-4)"]," ",["instanceof","var(--ch-7)"]," ",["XPromise","var(--ch-3)"],[") {","var(--ch-4)"],"\n              ",["res.","var(--ch-4)"],["then","var(--ch-5)"],["(resolveNext, rejectNext)","var(--ch-4)"],"\n            ",["}","var(--ch-4)"]," ",["else","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n              ",["resolveNext","var(--ch-5)"],["(res)","var(--ch-4)"],"\n            ",["}","var(--ch-4)"],"\n          ",["}","var(--ch-4)"],"\n        ",["}","var(--ch-4)"]," ",["catch","var(--ch-7)"]," ",["(err) {","var(--ch-4)"],"\n          ",["rejectNext","var(--ch-5)"],["(err)","var(--ch-4)"],"\n        ",["}","var(--ch-4)"],"\n      ",["}","var(--ch-4)"],"\n      ",["switch","var(--ch-7)"],["(","var(--ch-4)"],["this","var(--ch-2)"],[".PromiseState) {","var(--ch-4)"],"\n        ",["// 状态为 pending 时，收集回调","var(--ch-1)"],"\n        ",["case","var(--ch-7)"]," ",["pending:","var(--ch-4)"]," \n          ",["PromiseFulfillReactions.","var(--ch-4)"],["push","var(--ch-5)"],["({","var(--ch-4)"],"\n            ",["key:","var(--ch-4)"]," ",["this","var(--ch-2)"],[",","var(--ch-4)"],"\n            ",["callback: _resolved","var(--ch-4)"],"\n          ",["})","var(--ch-4)"],"\n          ",["PromiseRejectReactions.","var(--ch-4)"],["push","var(--ch-5)"],["({","var(--ch-4)"],"\n            ",["key:","var(--ch-4)"]," ",["this","var(--ch-2)"],[",","var(--ch-4)"],"\n            ",["callback: _rejected","var(--ch-4)"],"\n          ",["})","var(--ch-4)"],"\n          ",["break","var(--ch-7)"],"\n        ",["// 状态已经改变了，就直接执行回调","var(--ch-1)"],"\n        ",["case","var(--ch-7)"]," ",["fulfilled:","var(--ch-4)"],"\n          ",["promiseJobs.","var(--ch-4)"],["push","var(--ch-5)"],["(_resolved)","var(--ch-4)"],"\n          ",["break","var(--ch-7)"],"\n        ",["case","var(--ch-7)"]," ",["rejected:","var(--ch-4)"],"\n          ",["promiseJobs.","var(--ch-4)"],["push","var(--ch-5)"],["(_rejected)","var(--ch-4)"],"\n          ",["break","var(--ch-7)"],"\n      ",["}","var(--ch-4)"],"\n    ",["})","var(--ch-4)"],"\n  ",["}","var(--ch-4)"],"\n\n  ",["workLoop","var(--ch-5)"]," ",["=","var(--ch-7)"]," ",["()","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n    ",["setTimeout","var(--ch-5)"],["(()","var(--ch-4)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n      ",["let","var(--ch-7)"]," ",["cb","var(--ch-4)"],"\n      ",["while","var(--ch-7)"],["(cb","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["promiseJobs.","var(--ch-4)"],["shift","var(--ch-5)"],["()) {","var(--ch-4)"],"\n        ",["cb","var(--ch-5)"],["()","var(--ch-4)"],"\n      ",["}","var(--ch-4)"],"\n      ",["loopRunning","var(--ch-4)"]," ",["=","var(--ch-7)"]," ",["false","var(--ch-2)"],"\n    ",["},","var(--ch-4)"]," ",["0","var(--ch-2)"],[")","var(--ch-4)"],"\n  ",["}","var(--ch-4)"],"\n\n  ",["catch","var(--ch-5)"]," ",["=","var(--ch-7)"]," ",["(onRejected","var(--ch-3)"],[":","var(--ch-7)"]," ",["any","var(--ch-2)"],[")","var(--ch-3)"]," ",["=>","var(--ch-7)"]," ",["{","var(--ch-4)"],"\n    ",["return","var(--ch-7)"]," ",["this","var(--ch-2)"],[".","var(--ch-4)"],["then","var(--ch-5)"],["(","var(--ch-4)"],["null","var(--ch-2)"],[", onRejected)","var(--ch-4)"],"\n  ",["}","var(--ch-4)"],"\n",["}","var(--ch-3)"]],"annotations":[],"themeName":"github-from-css","style":{"color":"var(--ch-4)","background":"var(--ch-16)","colorScheme":"var(--ch-0)"}}]}]]}]}]
